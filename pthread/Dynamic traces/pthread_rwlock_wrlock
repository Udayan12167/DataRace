xor r10, r10
mov esi, 0x1
xor eax, eax
lock cmpxchg dword ptr [rdi], esi
jnz 0x7f46cc3aed39
mov eax, dword ptr [rdi+0x18]
test eax, eax
jnz 0x7f46cc3aed43
cmp dword ptr [rdi+0x4], 0x0
jz 0x7f46cc3aed23
xor edx, edx
mov eax, dword ptr fs:[0x2d0]
mov dword ptr [rdi+0x18], eax
lock dec dword ptr [rdi]
jnz 0x7f46cc3aed54
mov rax, rdx
ret 
